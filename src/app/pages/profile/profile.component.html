<div class="container d-flex justify-content-center profile-container">
    <div class="profile-card-container">
        <div class="profile-header text-center mb-5">
            
            <div class="profile-img-container mb-4">
                <ng-container *ngIf="user.profilePictureUrl; else userIcon">
                    <img class="profile-img fade-in" [src]="user.profilePictureUrl" alt="Foto de perfil">
                </ng-container>
                <ng-template #userIcon>
                    <i class="bi bi-person-circle fade-in"></i> <!-- Icono de usuario -->
                </ng-template>                
            </div>
            <h2 class="text-uppercase fw-bold">Bienvenido, {{ user.firstName }} {{ user.lastName }}</h2>
        </div>

        <div class="profile-info row">
            <!-- Datos Personales -->
            <div class="col-md-6">
                <div class="profile-card">
                    <div class="profile-card-header">
                        <b>Datos Personales</b>
                    </div>
                    <div class="profile-card-body">
                        <div class="profile-info-container">
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-person-lines-fill"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">NOMBRES</div>
                                    <div class="profile-info-value">{{ user.firstName }}</div>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-person-lines-fill"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">APELLIDOS</div>
                                    <div class="profile-info-value">{{ user.lastName }}</div>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-card-text"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">DOCUMENTO</div>
                                    <div class="profile-info-value">{{ user.documentType }}</div>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-file-earmark-text"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">N° DOCUMENTO</div>
                                    <div class="profile-info-value">{{ user.documentNumber }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- Datos de Contacto -->
            <div class="col-md-6">
                <div class="profile-card">
                    <div class="profile-card-header">
                        <b>Datos de Contacto</b>
                    </div>
                    <div class="profile-card-body">
                        <div class="profile-info-container">
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-telephone-fill"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">TELEFONO</div>
                                    <div class="profile-info-value">{{ user.phoneNumber }}</div>
                                </div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="bi bi-envelope-fill"></i>
                                </div>
                                <div class="profile-info-text">
                                    <div class="profile-info-label">EMAIL</div>
                                    <div class="profile-info-value">{{ user.email }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="actions d-flex justify-content-center mt-4">
            <button data-bs-toggle="modal" data-bs-target="#updateModal" class="btn btn-action btn-primary mx-3">
                <i class="bi bi-pencil-square"></i> Actualizar Datos
            </button>
            <button data-bs-toggle="modal" data-bs-target="#changePasswordModal" class="btn btn-action btn-secondary mx-3">
                <i class="bi bi-key-fill"></i> Cambiar Contraseña
            </button>
        </div>
        
    </div>
</div>


<!-- Modal para Actualizar Datos -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title text-white" id="updateModalLabel" style="text-align: center; width: 100%;">Actualizar Datos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="loadUserData()"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="name">Nombre</label>
                        <input type="text" class="form-control" id="name" [(ngModel)]="user.firstName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="surname">Apellidos</label>
                        <input type="text" class="form-control" id="surname" [(ngModel)]="user.lastName" name="surname" required>
                    </div>
                    <div class="mb-3">
                        <div class="row">
                            <div class="col">
                                <label for="inputDocumentType" class="form-label">Tipo de Documento:</label>
                                <select class="form-select" id="inputDocumentType" [(ngModel)]="user.documentType" name="document_type">
                                    <option value="DNI">DNI</option>
                                    <option value="PASAPORTE">PASAPORTE</option>
                                    <option value="RUC">RUC</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="inputDocumentNumber" class="form-label">N° de Documento:</label>
                                <input type="text" class="form-control" id="inputDocumentNumber" [(ngModel)]="user.documentNumber" name="document_number" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone">Teléfono</label>
                        <input type="text" class="form-control" id="phone" [(ngModel)]="user.phoneNumber" name="phone_number" required>
                    </div>
                    <div class="form-group">
                        <label for="mail">Correo</label>
                        <input type="email" class="form-control" id="mail" [(ngModel)]="user.email" name="email" required>
                    </div>
                    <div class="form-group mt-3 text-center">
                        <div class="image-preview d-flex align-items-center justify-content-center" *ngIf="imagePreview">
                            <img style="max-width: 100px; max-height: 100px; border-radius: 10px; margin-bottom: 2px;" [src]="imagePreview" alt="Vista previa de la imagen">
                        </div>
                        <label>
                            <i class="fas fa-upload"></i> Foto
                        </label>
                        <input id="file-upload" type="file" accept=".jpg, .jpeg, .png, .webp" (change)="onFileChange($event)">
                    </div>
                </form>
            </div>
            <div class="modal-footer d-flex align-items-center justify-content-center">
                <!-- Botón de guardar cambios -->
                <button 
                    type="submit" 
                    class="btn btn-action btn-primary m-2" 
                    (click)="updateProfile()" 
                    [disabled]="isLoading">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span *ngIf="!isLoading"><i class="bi bi-save me-2"></i>Guardar cambios</span>
                    <span *ngIf="isLoading">Actualizando...</span>
                </button>
            
                <!-- Botón de cancelar -->
                <button type="button" class="btn btn-action btn-secondary m-2" data-bs-dismiss="modal" (click)="loadUserData()">
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                </button>
            
                <!-- Botón de cierre invisible -->
                <button 
                    type="button" 
                    class="d-none" 
                    id="closeButtonProfile" 
                    data-bs-dismiss="modal">
                </button>
            </div>
            
        </div>
    </div>
</div>

<!-- Modal para Cambiar Contraseña -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title text-white" id="changePasswordModalLabel" style="text-align: center; width: 100%;">Cambiar Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-5">
                <form >
                    <div class="form-group">
                        <label for="oldPassword">Contraseña Actual</label>
                        <input type="password" class="form-control" id="oldPassword" [(ngModel)]="oldPassword" name="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Nueva Contraseña</label>
                        <input type="password" class="form-control" id="newPassword" [(ngModel)]="newPassword" name="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Confirmar Nueva Contraseña</label>
                        <input type="password" class="form-control" id="confirmNewPassword" [(ngModel)]="confirmNewPassword" name="confirmNewPassword" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer d-flex align-items-center justify-content-center">
                <!-- Botón para guardar cambios (con animación y borde redondeado) -->
                <button type="submit" class="btn btn-action btn-primary m-2" (click)="updatePassword()" [disabled]="isLoading">
                    <!-- Spinner de carga que aparece mientras se está actualizando -->
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <!-- Texto normal cuando no se está actualizando -->
                    <span *ngIf="!isLoading"><i class="bi bi-save me-2"></i>Guardar cambios</span>
                    <!-- Texto mientras se está actualizando -->
                    <span *ngIf="isLoading">Actualizando...</span>
                </button>
                
                <!-- Botón para cerrar el modal -->
                <button type="button" class="btn btn-action btn-secondary m-3" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cerrar
                </button>
                
                <!-- Botón de cierre invisible para usabilidad -->
                <button 
                    type="button" 
                    class="d-none" 
                    id="closeButtonUpdatePassword" 
                    data-bs-dismiss="modal">
                </button>
            </div>
            
        </div>
    </div>
</div>
